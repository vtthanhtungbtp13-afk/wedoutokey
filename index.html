<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lấy giá trị key từ URL</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; /* dark blue */
      --card:#0b1220;
      --muted:#94a3b8;
      --accent:#6ee7b7;
      --glass: rgba(255,255,255,0.03);
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;background:linear-gradient(180deg,#071029 0%,#061621 60%);font-family:Inter,system-ui,Arial,sans-serif;color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:28px;
    }
    .wrap{width:100%;max-width:920px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    .logo{width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#042024;box-shadow:0 6px 20px rgba(6,12,34,0.6)}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:20px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}

    .row{display:flex;gap:12px;align-items:center}
    .input-group{display:flex;gap:8px;margin-top:12px}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:15px}
    button{padding:10px 14px;border-radius:10px;border:0;background:linear-gradient(90deg,#0ea5a5,#34d399);color:#042024;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}

    .meta{display:flex;gap:10px;align-items:center;margin-top:12px}
    code.badge{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;font-size:13px;color:var(--accent)}

    .preview{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:14px;border-radius:10px;border:1px dashed rgba(255,255,255,0.03)}
    .hint{margin-top:10px;color:var(--muted);font-size:13px}

    .toast{position:fixed;right:20px;bottom:20px;background:#05202a;padding:12px 16px;border-radius:10px;box-shadow:0 8px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);display:none}
    .toast.show{display:block}

    @media (max-width:640px){header{gap:10px}.logo{width:56px;height:56px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">K</div>
      <div>
        <h1>Lấy và chỉnh sửa giá trị <code>key</code> từ URL</h1>
        <p class="lead">Trang nhỏ tiện ích để đọc giá trị <code>key</code> trong link, chỉnh sửa và sao chép nhanh.</p>
      </div>
    </header>

    <main class="card">
      <div class="row">
        <div style="flex:1">
          <div class="small">Giá trị <code>key=</code> hiện tại (nếu có):</div>
          <div class="input-group">
            <input id="keyInput" type="text" placeholder="Không có key trong URL" />
            <button id="copyBtn" title="Sao chép">Sao chép</button>
            <button id="applyBtn" class="ghost" title="Cập nhật URL">Áp dụng</button>
          </div>
          <div class="meta">
            <code class="badge" id="rawQuery">?</code>
            <div class="small" id="status">Đang chờ...</div>
          </div>
        </div>
      </div>

      <div class="preview" id="previewArea">
        <div><strong>URL hiện tại:</strong></div>
        <div id="currentUrl" style="word-break:break-all;margin-top:6px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, monospace"></div>
        <div class="hint">Bạn có thể dán link chứa <code>?key=...</code> vào thanh địa chỉ trình duyệt để xem giá trị tự động.</div>
      </div>
    </main>

    <div class="toast" id="toast">Đã sao chép!</div>
  </div>

  <script>
    // Helper: lấy giá trị param từ query string
    function getParam(name, url) {
      if (!url) url = window.location.href;
      name = name.replace(/[\[\]]/g, "\\$&");
      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
      var results = regex.exec(url);
      if (!results) return null;
      if (!results[2]) return '';
      return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    const keyInput = document.getElementById('keyInput');
    const copyBtn = document.getElementById('copyBtn');
    const applyBtn = document.getElementById('applyBtn');
    const previewArea = document.getElementById('previewArea');
    const currentUrl = document.getElementById('currentUrl');
    const rawQuery = document.getElementById('rawQuery');
    const status = document.getElementById('status');
    const toast = document.getElementById('toast');

    function showToast(text = 'Đã sao chép!', ms = 1400){
      toast.textContent = text; toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), ms);
    }

    function updateUI(){
      const k = getParam('key');
      keyInput.value = k === null ? '' : k;
      rawQuery.textContent = window.location.search || '(rỗng)';
      currentUrl.textContent = window.location.href;
      status.textContent = k === null ? 'Không tìm thấy param key trong URL.' : 'Đã tìm thấy giá trị key.';
    }

    // Khi bấm copy: copy nội dung input (nếu rỗng thì copy toàn bộ URL)
    copyBtn.addEventListener('click', async ()=>{
      const val = keyInput.value.trim();
      try{
        await navigator.clipboard.writeText(val || window.location.href);
        showToast(val ? 'Đã sao chép key!' : 'Đã sao chép URL!');
      }catch(e){
        // fallback
        const temp = document.createElement('textarea'); temp.value = val || window.location.href; document.body.appendChild(temp); temp.select();
        try{document.execCommand('copy'); showToast('Đã sao chép (fallback)!');}catch(err){alert('Không thể sao chép — vui lòng copy thủ công.');}
        temp.remove();
      }
    });

    // Áp dụng: cập nhật query string (pushState) hoặc thêm key nếu chưa có
    applyBtn.addEventListener('click', ()=>{
      const val = keyInput.value.trim();
      const url = new URL(window.location.href);
      if(val===''){
        url.searchParams.delete('key');
      }else{
        url.searchParams.set('key', val);
      }
      window.history.pushState({}, '', url.toString());
      updateUI();
      showToast('URL đã cập nhật');
    });

    // Khi người sửa nội dung input, đổi trạng thái nhỏ
    keyInput.addEventListener('input', ()=>{
      if(keyInput.value.trim() === '') status.textContent = 'Bạn đang nhập (rỗng).';
      else status.textContent = 'Bạn đang chỉnh sửa giá trị key.';
    });

    // Khi trình duyệt quay/đi tới history, cập nhật giao diện
    window.addEventListener('popstate', updateUI);

    // Khởi tạo
    updateUI();

    // Tùy chọn: nếu user muốn dán một URL vào input để parse ngay
    // Giúp: nếu người dùng dán 1 link chứa ?key=... thì nút "Phân tích" tự động
    keyInput.addEventListener('paste', (e)=>{
      setTimeout(()=>{
        const val = keyInput.value.trim();
        if(/^https?:\/\//i.test(val)){
          // Nếu dán là 1 URL, parse key từ đó và hiển thị (không thay đổi URL trang)
          const parsed = getParam('key', val);
          if(parsed !== null){ keyInput.value = parsed; status.textContent = 'Đã đọc key từ URL vừa dán.'; }
          else { status.textContent = 'URL dán vào không có param key.'; }
        }
      }, 50);
    });

  </script>
</body>
</html>

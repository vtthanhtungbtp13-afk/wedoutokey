<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lấy giá trị `key` — Light Theme</title>
  <style>
    :root{
      --bg: #f7f9fc;
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #2563eb;
      --green: #16a34a;
      --radius: 12px;
      font-family: Inter, Roboto, "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg),#ffffff);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .card{
      width:100%;
      max-width:820px;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:0 6px 30px rgba(15,23,42,0.06);
      padding:28px;
      box-sizing:border-box;
    }

    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}

    .row{display:flex;gap:12px}
    .row.stack{flex-direction:column}

    input[type="text"]{
      flex:1;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6e9ef;
      outline:none;
      font-size:14px;
      box-sizing:border-box;
      background:#fbfdff;
    }

    button{
      background:var(--accent);
      color:#fff;
      border:0;
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      box-shadow:0 6px 18px rgba(37,99,235,0.12);
    }

    .result{
      margin-top:18px;
      padding:14px;
      border-radius:10px;
      background:#fbfeff;
      border:1px dashed #e6eefc;
      display:flex;align-items:center;justify-content:space-between;gap:12px
    }

    .badge{font-size:12px;color:var(--muted);padding:6px 8px;border-radius:8px;background:#f1f5f9}

    .empty{color:var(--muted)}

    .small{font-size:13px;color:var(--muted);margin-top:12px}

    .copy-btn{
      background:transparent;border:1px solid #e6eefc;color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600
    }

    footer{margin-top:20px;color:var(--muted);font-size:13px}

    @media (max-width:600px){
      .row{flex-direction:column}
      button{width:100%}
    }
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Lấy giá trị <code>key</code> từ liên kết</h1>
    <p class="lead">Trang nhẹ (light theme). Tự động lấy tham số <code>key</code> từ URL hiện tại khi mở trang. Bạn cũng có thể dán 1 URL vào ô bên dưới và nhấn "Lấy key".</p>

    <div class="row stack">
      <div class="row">
        <input id="urlInput" type="text" placeholder="Dán URL vào đây hoặc để trống để lấy từ URL hiện tại" aria-label="URL input" />
        <button id="extractBtn">Lấy key</button>
      </div>

      <div id="result" class="result" aria-live="polite">
        <div>
          <div class="badge">Giá trị <code>key</code>:</div>
          <div id="value" style="margin-top:8px;font-weight:700;font-size:16px">—</div>
          <div id="hint" class="small">Nếu không có tham số <code>key</code>, kết quả sẽ rỗng.</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;min-width:110px;align-items:flex-end">
          <button id="copyBtn" class="copy-btn">Sao chép</button>
          <button id="openBtn" class="copy-btn">Mở link</button>
        </div>
      </div>
    </div>

    <footer>Ví dụ: <code>?key=ABC123</code> hoặc <code>?foo=1&amp;key=giá%20trị</code></footer>
  </div>

  <script>
    // Hàm lấy tham số query string an toàn
    function getQueryParam(url, name) {
      try {
        // Nếu người dùng dán chuỗi chỉ là query như "key=123", chuyển thành URL tạm
        if (!/^https?:\/\//i.test(url)) {
          // Nếu bắt đầu bằng ? thì thêm trang mặc định
          if (url.trim().startsWith('?') || url.includes('=')) {
            url = window.location.origin + (url.startsWith('?') ? window.location.pathname + url : window.location.pathname + '?' + url);
          } else {
            // nếu rỗng, dùng window.location
            url = window.location.href;
          }
        }
        const u = new URL(url);
        // URLSearchParams tự decode
        return u.searchParams.get(name);
      } catch (e) {
        console.warn('Không parse được URL:', e);
        return null;
      }
    }

    const valueEl = document.getElementById('value');
    const hintEl = document.getElementById('hint');
    const input = document.getElementById('urlInput');
    const btn = document.getElementById('extractBtn');
    const copyBtn = document.getElementById('copyBtn');
    const openBtn = document.getElementById('openBtn');

    function showValue(v) {
      if (v === null || v === undefined) {
        valueEl.textContent = '—';
        hintEl.textContent = 'Không tìm thấy tham số "key".';
      } else if (v === '') {
        valueEl.textContent = '(chuỗi rỗng)';
        hintEl.textContent = 'Tham số tồn tại nhưng rỗng.';
      } else {
        valueEl.textContent = v;
        hintEl.textContent = '';
      }
    }

    // Lấy từ URL hiện tại khi load
    window.addEventListener('DOMContentLoaded', () => {
      const current = getQueryParam(window.location.href, 'key');
      showValue(current);
      // Nếu có value, hiển thị luôn URL vào input để người dùng dễ copy/mở
      if (current !== null) input.value = window.location.href;
    });

    btn.addEventListener('click', () => {
      const url = input.value.trim();
      const v = getQueryParam(url || window.location.href, 'key');
      showValue(v);
    });

    copyBtn.addEventListener('click', async () => {
      const text = valueEl.textContent;
      if (!text || text === '—') return alert('Không có giá trị để sao chép.');
      try {
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = 'Đã sao chép ✓';
        setTimeout(()=> copyBtn.textContent = 'Sao chép',1200);
      } catch (e) {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text; document.body.appendChild(ta); ta.select();
        try { document.execCommand('copy'); alert('Đã sao chép'); } catch(e){ alert('Trình duyệt không hỗ trợ sao chép tự động.'); }
        ta.remove();
      }
    });

    openBtn.addEventListener('click', () => {
      const url = input.value.trim() || window.location.href;
      if (!url) return alert('Không có link để mở.');
      // nếu người nhập chỉ nhập query như key=xxx thì mở window.location với query
      let toOpen = url;
      if (!/^https?:\/\//i.test(url)) {
        if (url.startsWith('?') || url.includes('=')) {
          toOpen = window.location.origin + window.location.pathname + (url.startsWith('?')?url:'?'+url);
        } else {
          toOpen = 'https://' + url;
        }
      }
      window.open(toOpen, '_blank');
    });

    // Hỗ trợ Enter trong input
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') btn.click(); });
  </script>
</body>
</html>